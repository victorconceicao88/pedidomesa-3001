<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Faça seu pedido online no Restaurante Cozinha da Vivi - Comida caseira de qualidade">
  <title>Cozinha da Vivi - Pedido Online</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

  <style>
    :root {
      --primary-color: #ff6b6b;
      --secondary-color: #ffa502;
      --dark-color: #2f3542;
      --light-color: #f1f2f6;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .main-content {
      flex: 1;
    }
    
    .product {
      transition: all 0.3s ease;
      cursor: pointer;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .product:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
    
    .product-image {
      height: 180px;
      object-fit: cover;
      transition: transform 0.3s;
    }
    
    .product:hover .product-image {
      transform: scale(1.03);
    }
    
    .add-to-cart {
      background-color: var(--primary-color);
      border: none;
      transition: all 0.3s;
    }
    
    .add-to-cart:hover {
      background-color: #ff5252;
      transform: scale(1.05);
    }
    
    .card-header {
      background-color: var(--primary-color) !important;
    }
    
    .remove-item {
      transition: all 0.3s;
    }
    
    .remove-item:hover {
      transform: scale(1.1);
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .btn-primary:hover {
      background-color: #ff5252;
      border-color: #ff5252;
    }
    
    #checkout-button {
      transition: all 0.3s;
      background-color: var(--primary-color);
      border: none;
    }
    
    #checkout-button:hover {
      background-color: #ff5252;
      transform: translateY(-2px);
    }
    
    #checkout-button:disabled {
      background-color: #adb5bd;
    }
    
    .badge.bg-primary {
      background-color: var(--primary-color) !important;
    }
    
    .badge.bg-success {
      background-color: #20c997 !important;
    }
    
    .sticky-top {
      top: 1rem;
    }
    
    footer {
      background-color: var(--dark-color) !important;
    }
    
    .text-primary {
      color: var(--primary-color) !important;
    }
    
    .quantity-control {
      display: flex;
      align-items: center;
    }
    
    .quantity-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--light-color);
      border: none;
      cursor: pointer;
    }
    
    .quantity-input {
      width: 40px;
      text-align: center;
      border: none;
      background: transparent;
      font-weight: bold;
    }
    
    .cart-item-quantity {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .empty-cart-icon {
      font-size: 3rem;
      opacity: 0.2;
    }
    
    .filter-btn.active {
      background-color: var(--primary-color);
      color: white;
    }
    
    /* Checkout Page Styles */
    .checkout-container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .checkout-step {
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid #eee;
    }
    
    .checkout-step:last-child {
      border-bottom: none;
    }
    
    .delivery-option-card {
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    
    .delivery-option-card:hover {
      border-color: var(--primary-color);
    }
    
    .delivery-option-card.active {
      border-color: var(--primary-color);
      background-color: rgba(255, 107, 107, 0.1);
    }
    
    .payment-method-card {
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    
    .payment-method-card:hover {
      border-color: var(--primary-color);
    }
    
    .payment-method-card.active {
      border-color: var(--primary-color);
      background-color: rgba(255, 107, 107, 0.1);
    }
    
    /* Admin Panel Styles */
    .admin-navbar {
      background-color: var(--dark-color);
    }
    
    .order-card {
      transition: all 0.3s;
      border-left: 4px solid var(--primary-color);
    }
    
    .order-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .order-status-badge {
      font-size: 0.8rem;
      padding: 0.35em 0.65em;
    }
    
    .status-pending {
      background-color: #ffc107;
    }
    
    .status-preparing {
      background-color: #fd7e14;
    }
    
    .status-ready {
      background-color: #20c997;
    }
    
    .status-delivered {
      background-color: #198754;
    }
    
    .status-cancelled {
      background-color: #dc3545;
    }
    
    /* Kitchen Print Styles */
    .kitchen-order {
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.3;
      padding: 10px;
      max-width: 58mm;
    }
    
    .kitchen-order-header {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
      border-bottom: 1px dashed #000;
      padding-bottom: 5px;
    }
    
    .kitchen-order-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 3px;
    }
    
    .kitchen-order-footer {
      border-top: 1px dashed #000;
      margin-top: 10px;
      padding-top: 5px;
      font-weight: bold;
    }
    
    /* Cart Sidebar Styles */
    .cart-sidebar {
      position: fixed;
      top: 0;
      right: -400px;
      width: 100%;
      max-width: 400px;
      height: 100vh;
      background-color: white;
      z-index: 1050;
      transition: right 0.3s ease;
      box-shadow: -5px 0 15px rgba(0,0,0,0.1);
      overflow-y: auto;
    }
    
    .cart-sidebar.show {
      right: 0;
    }
    
    .cart-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1040;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
    }
    
    .cart-overlay.show {
      opacity: 1;
      visibility: visible;
    }
    
    /* Cart Icon Styles */
    .cart-icon-container {
      position: relative;
      cursor: pointer;
    }
    
    .cart-icon-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .product-image {
        height: 150px;
      }
      
      .filter-buttons {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .filter-btn {
        margin-bottom: 5px;
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
      }
      
      .checkout-step {
        padding-bottom: 1rem;
        margin-bottom: 1.5rem;
      }
      
      .cart-sidebar {
        max-width: 100%;
      }
    }
    
    @media (max-width: 576px) {
      .product-image {
        height: 120px;
      }
      
      .cart-item-quantity {
        flex-direction: column;
        align-items: flex-end;
      }
      
      .checkout-step {
        padding-bottom: 0.75rem;
        margin-bottom: 1rem;
      }
      
      .filter-buttons {
        margin-top: 10px;
      }
      
      .delivery-option-card, .payment-method-card {
        margin-bottom: 10px;
      }
    }
    
    /* Admin Panel Improvements */
    .admin-panel-container {
      padding-top: 20px;
    }
    
    .admin-stats-card {
      border-left: 4px solid var(--primary-color);
      margin-bottom: 20px;
    }
    
    .admin-stats-card .card-body {
      padding: 1rem;
    }
    
    .admin-stats-card h5 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .admin-stats-card .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .order-actions {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }
    
    .order-actions .btn {
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
    }
    
    /* Print Styles for Kitchen */
    @media print {
      body * {
        visibility: hidden;
      }
      #kitchen-order-print, #kitchen-order-print * {
        visibility: visible;
      }
      #kitchen-order-print {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: auto;
      }
    }
  </style>
</head>
<body>
  <!-- Main Navigation -->
  <header class="bg-dark text-white py-3 sticky-top shadow-sm">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-0 fw-bold"><span class="text-primary">Cozinha</span> da Vivi</h1>
          <p class="mb-0 small text-muted">Comida caseira com amor</p>
        </div>
        <div class="cart-icon-container" id="cart-indicator">
          <i class="fas fa-shopping-bag fa-lg"></i>
          <span id="cart-count" class="cart-icon-badge" style="display: none;">0</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Cart Overlay -->
  <div class="cart-overlay" id="cart-overlay"></div>

  <!-- Cart Sidebar -->
  <div class="cart-sidebar" id="cart-sidebar">
    <div class="card border-0 h-100">
      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0"><i class="fas fa-shopping-bag me-2"></i> Seu Pedido</h2>
        <button class="btn btn-sm btn-outline-light" id="close-cart">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="card-body p-0 d-flex flex-column">
        <div id="cart-items" class="list-group list-group-flush flex-grow-1">
          <div class="list-group-item text-center py-4 empty-cart">
            <i class="fas fa-shopping-bag empty-cart-icon mb-3"></i>
            <p class="mb-0">Seu carrinho está vazio</p>
            <small class="text-muted">Adicione itens para continuar</small>
          </div>
        </div>
        <div class="p-3 border-top">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">Subtotal:</span>
            <span id="subtotal" class="fw-bold">R$ 0,00</span>
          </div>
          
          <div class="d-flex justify-content-between align-items-center border-top pt-3">
            <span class="h5 mb-0">Total:</span>
            <span id="total" class="h4 mb-0 text-primary fw-bold">R$ 0,00</span>
          </div>
          
          <button id="checkout-button" class="btn btn-primary w-100 mt-3 py-2 fw-bold" disabled>
            <i class="fas fa-check-circle me-2"></i> Finalizar Pedido
          </button>
          
          <p class="small text-muted mt-2 mb-0 text-center">
            <i class="fas fa-lock me-1"></i> Seus dados estão protegidos
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Product Section (Visible by default) -->
    <section id="product-section" class="container my-4">
      <div class="row">
        <!-- Seção de Produtos -->
        <section id="products" class="col-12 mb-5">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
            <h2 class="h4 fw-bold mb-3 mb-md-0">Nosso Cardápio</h2>
            <div class="btn-group filter-buttons" role="group">
              <button type="button" class="filter-btn btn btn-outline-secondary active" data-category="all">Todos</button>
              <button type="button" class="filter-btn btn btn-outline-secondary" data-category="pratos">Pratos</button>
              <button type="button" class="filter-btn btn btn-outline-secondary" data-category="sobremesas">Sobremesas</button>
              <button type="button" class="filter-btn btn btn-outline-secondary" data-category="bebidas">Bebidas</button>
            </div>
          </div>

          <div class="row g-4" id="product-container">
            <!-- Prato 1 -->
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card product h-100 border-0 shadow-sm" data-id="1" data-category="pratos">
                <div class="badge bg-primary position-absolute" style="top: 0.5rem; right: 0.5rem">Mais pedido</div>
                <img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Frango à Parmegiana" class="card-img-top product-image">
                <div class="card-body">
                  <h3 class="h5 card-title product-name">Frango à Parmegiana</h3>
                  <p class="card-text text-muted small">Filé de frango empanado com molho de tomate caseiro e queijo derretido</p>
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="h5 mb-0 product-price">R$ 32,90</span>
                    <button class="add-to-cart btn btn-primary rounded-pill px-3">
                      <i class="fas fa-plus me-1"></i> Adicionar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Prato 2 -->
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card product h-100 border-0 shadow-sm" data-id="2" data-category="pratos">
                <img src="https://images.unsplash.com/photo-1512621776951-a57141f2eefd?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Salada Tropical" class="card-img-top product-image">
                <div class="card-body">
                  <h3 class="h5 card-title product-name">Salada Tropical</h3>
                  <p class="card-text text-muted small">Mix de folhas, manga, abacate, nozes e molho de iogurte</p>
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="h5 mb-0 product-price">R$ 24,50</span>
                    <button class="add-to-cart btn btn-primary rounded-pill px-3">
                      <i class="fas fa-plus me-1"></i> Adicionar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Prato 3 -->
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card product h-100 border-0 shadow-sm" data-id="3" data-category="pratos">
                <img src="https://images.unsplash.com/photo-1473093295043-cdd812d0e601?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Risoto de Cogumelos" class="card-img-top product-image">
                <div class="card-body">
                  <h3 class="h5 card-title product-name">Risoto de Cogumelos</h3>
                  <p class="card-text text-muted small">Risoto cremoso com mix de cogumelos frescos e ervas finas</p>
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="h5 mb-0 product-price">R$ 28,90</span>
                    <button class="add-to-cart btn btn-primary rounded-pill px-3">
                      <i class="fas fa-plus me-1"></i> Adicionar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Prato 4 -->
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card product h-100 border-0 shadow-sm" data-id="4" data-category="pratos">
                <div class="badge bg-success position-absolute" style="top: 0.5rem; right: 0.5rem">Novidade</div>
                <img src="https://images.unsplash.com/photo-1559847844-5315695dadae?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Strogonoff de Carne" class="card-img-top product-image">
                <div class="card-body">
                  <h3 class="h5 card-title product-name">Strogonoff de Carne</h3>
                  <p class="card-text text-muted small">Tradicional strogonoff com carne macia, creme de leite e champignons</p>
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="h5 mb-0 product-price">R$ 35,90</span>
                    <button class="add-to-cart btn btn-primary rounded-pill px-3">
                      <i class="fas fa-plus me-1"></i> Adicionar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Prato 5 -->
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card product h-100 border-0 shadow-sm" data-id="5" data-category="pratos">
                <img src="https://images.unsplash.com/photo-1565557623262-b51c2513a641?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Moqueca de Peixe" class="card-img-top product-image">
                <div class="card-body">
                  <h3 class="h5 card-title product-name">Moqueca de Peixe</h3>
                  <p class="card-text text-muted small">Peixe branco cozido no leite de coco com dendê e pimentões</p>
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="h5 mb-0 product-price">R$ 42,50</span>
                    <button class="add-to-cart btn btn-primary rounded-pill px-3">
                      <i class="fas fa-plus me-1"></i> Adicionar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Prato 6 -->
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card product h-100 border-0 shadow-sm" data-id="6" data-category="pratos">
                <img src="https://images.unsplash.com/photo-1601050690597-df0568f70950?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Lasanha à Bolonhesa" class="card-img-top product-image">
                <div class="card-body">
                  <h3 class="h5 card-title product-name">Lasanha à Bolonhesa</h3>
                  <p class="card-text text-muted small">Camadas de massa fresca com molho bolonhesa e queijos</p>
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="h5 mb-0 product-price">R$ 38,90</span>
                    <button class="add-to-cart btn btn-primary rounded-pill px-3">
                      <i class="fas fa-plus me-1"></i> Adicionar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sobremesa 1 -->
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card product h-100 border-0 shadow-sm" data-id="7" data-category="sobremesas">
                <img src="https://images.unsplash.com/photo-1563805042-7684c019e1cb?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Brownie com Sorvete" class="card-img-top product-image">
                <div class="card-body">
                  <h3 class="h5 card-title product-name">Brownie com Sorvete</h3>
                  <p class="card-text text-muted small">Brownie caseiro com sorvete de creme e calda de chocolate</p>
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="h5 mb-0 product-price">R$ 18,90</span>
                    <button class="add-to-cart btn btn-primary rounded-pill px-3">
                      <i class="fas fa-plus me-1"></i> Adicionar
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Bebida 1 -->
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card product h-100 border-0 shadow-sm" data-id="8" data-category="bebidas">
                <img src="https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Suco Natural" class="card-img-top product-image">
                <div class="card-body">
                  <h3 class="h5 card-title product-name">Suco Natural (500ml)</h3>
                  <p class="card-text text-muted small">Opções: Laranja, Maracujá, Abacaxi com Hortelã</p>
                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <span class="h5 mb-0 product-price">R$ 12,00</span>
                    <button class="add-to-cart btn btn-primary rounded-pill px-3">
                      <i class="fas fa-plus me-1"></i> Adicionar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- Checkout Section (Hidden by default) -->
    <section id="checkout-section" class="container my-4 d-none">
      <div class="checkout-container">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <div class="card border-0 shadow-sm mb-4">
              <div class="card-header bg-primary text-white">
                <h2 class="h5 mb-0"><i class="fas fa-shopping-bag me-2"></i> Finalizar Pedido</h2>
              </div>
              <div class="card-body">
                <div class="checkout-step">
                  <h3 class="h5 mb-3">1. Método de Recebimento</h3>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="card delivery-option-card p-3 active" id="delivery-option">
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="delivery-method" id="delivery-method" value="entrega" checked>
                          <label class="form-check-label fw-bold" for="delivery-method">
                            <i class="fas fa-motorcycle me-2"></i> Entrega
                          </label>
                        </div>
                        <p class="small text-muted mt-2">Entregamos no seu endereço (Taxa: R$ 5,00)</p>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card delivery-option-card p-3" id="pickup-option">
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="delivery-method" id="pickup-method" value="retirada">
                          <label class="form-check-label fw-bold" for="pickup-method">
                            <i class="fas fa-store me-2"></i> Retirada
                          </label>
                        </div>
                        <p class="small text-muted mt-2">Retire seu pedido no restaurante</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="checkout-step">
                  <h3 class="h5 mb-3">2. Informações do Cliente</h3>
                  <form id="customer-info-form">
                    <div class="row g-3">
                      <div class="col-md-6">
                        <label for="customer-name" class="form-label">Nome Completo *</label>
                        <input type="text" class="form-control" id="customer-name" required>
                      </div>
                      <div class="col-md-6">
                        <label for="customer-phone" class="form-label">Telefone *</label>
                        <input type="tel" class="form-control" id="customer-phone" required placeholder="+351 933 737 672">
                      </div>
                      <div class="col-12 delivery-field">
                        <label for="customer-whatsapp" class="form-label">WhatsApp (para contato)</label>
                        <input type="tel" class="form-control" id="customer-whatsapp" placeholder="+351 933 737 672">
                      </div>
                      <div class="col-12 delivery-field">
                        <label for="customer-address" class="form-label">Endereço *</label>
                        <input type="text" class="form-control" id="customer-address" placeholder="Rua, Número, Bairro">
                      </div>
                      <div class="col-md-6 delivery-field">
                        <label for="customer-complement" class="form-label">Complemento</label>
                        <input type="text" class="form-control" id="customer-complement" placeholder="Apto, Bloco, Referência">
                      </div>
                      <div class="col-md-6 delivery-field">
                        <label for="customer-neighborhood" class="form-label">Bairro *</label>
                        <input type="text" class="form-control" id="customer-neighborhood">
                      </div>
                      <div class="col-12">
                        <label for="customer-instructions" class="form-label">Instruções para entrega</label>
                        <textarea class="form-control" id="customer-instructions" rows="2" placeholder="Ex: Portão azul, tocar campainha"></textarea>
                      </div>
                      <div class="col-12">
                        <label for="order-notes" class="form-label">Observações do pedido</label>
                        <textarea class="form-control" id="order-notes" rows="2" placeholder="Ex: Sem cebola, bem passado"></textarea>
                      </div>
                    </div>
                  </form>
                </div>

                <div class="checkout-step">
                  <h3 class="h5 mb-3">3. Método de Pagamento</h3>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="card payment-method-card p-3 active" id="mbway-payment">
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="payment-method" id="mbway-method" value="mbway" checked>
                          <label class="form-check-label fw-bold" for="mbway-method">
                            <i class="fas fa-mobile-alt me-2"></i> MB Way
                          </label>
                        </div>
                        <p class="small text-muted mt-2">Pagamento via MB Way (você receberá uma solicitação)</p>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card payment-method-card p-3" id="cash-payment">
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="payment-method" id="cash-method" value="dinheiro">
                          <label class="form-check-label fw-bold" for="cash-method">
                            <i class="fas fa-money-bill-wave me-2"></i> Dinheiro
                          </label>
                        </div>
                        <div id="cash-change-field" class="mt-2 d-none">
                          <label for="cash-change" class="form-label small">Valor para troco</label>
                          <input type="text" class="form-control form-control-sm" id="cash-change" placeholder="Ex: 50,00">
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card payment-method-card p-3" id="card-payment">
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="payment-method" id="card-method" value="cartao">
                          <label class="form-check-label fw-bold" for="card-method">
                            <i class="fas fa-credit-card me-2"></i> Cartão
                          </label>
                        </div>
                        <p class="small text-muted mt-2">Pagamento com máquina na entrega/retirada</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="checkout-step">
                  <h3 class="h5 mb-3">4. Resumo do Pedido</h3>
                  <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                      <div id="checkout-items" class="list-group list-group-flush">
                        <!-- Itens serão adicionados dinamicamente aqui -->
                      </div>
                      <div class="p-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                          <span class="text-muted">Subtotal:</span>
                          <span id="checkout-subtotal" class="fw-bold">R$ 0,00</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                          <span class="text-muted">Taxa de Entrega:</span>
                          <span id="checkout-delivery-fee" class="fw-bold">R$ 5,00</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center border-top pt-3">
                          <span class="h5 mb-0">Total:</span>
                          <span id="checkout-total" class="h4 mb-0 text-primary fw-bold">R$ 0,00</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="d-grid gap-2">
                  <button id="confirm-order-button" class="btn btn-primary btn-lg py-3">
                    <i class="fas fa-check-circle me-2"></i> Confirmar Pedido
                  </button>
                  <button id="back-to-cart-button" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i> Voltar para o Carrinho
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Panel (Hidden by default) -->
    <section id="admin-panel" class="container-fluid px-0 d-none">
      <nav class="navbar navbar-dark admin-navbar">
        <div class="container">
          <a class="navbar-brand" href="#">
            <i class="fas fa-utensils me-2"></i> Painel Administrativo
          </a>
          <div>
            <button id="admin-logout" class="btn btn-outline-light btn-sm">
              <i class="fas fa-sign-out-alt me-1"></i> Sair
            </button>
          </div>
        </div>
      </nav>

      <div class="container admin-panel-container my-4">
        <div class="row">
          <div class="col-md-3">
            <div class="card admin-stats-card mb-4">
              <div class="card-body">
                <h5 class="card-title">Pedidos Hoje</h5>
                <div class="stat-value text-primary" id="today-orders">0</div>
              </div>
            </div>
            
            <div class="card admin-stats-card mb-4">
              <div class="card-body">
                <h5 class="card-title">Em Preparo</h5>
                <div class="stat-value text-warning" id="preparing-orders">0</div>
              </div>
            </div>
            
            <div class="card admin-stats-card mb-4">
              <div class="card-body">
                <h5 class="card-title">Para Entregar</h5>
                <div class="stat-value text-info" id="delivery-orders">0</div>
              </div>
            </div>

            <div class="card">
              <div class="card-body">
                <h3 class="h5 card-title">Filtros</h3>
                <div class="mb-3">
                  <label class="form-label">Status</label>
                  <select class="form-select" id="status-filter">
                    <option value="all">Todos</option>
                    <option value="pending">Pendentes</option>
                    <option value="preparing">Em Preparo</option>
                    <option value="ready">Prontos</option>
                    <option value="delivered">Entregues</option>
                    <option value="cancelled">Cancelados</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Tipo</label>
                  <select class="form-select" id="type-filter">
                    <option value="all">Todos</option>
                    <option value="delivery">Entrega</option>
                    <option value="pickup">Retirada</option>
                  </select>
                </div>
                <button id="apply-filters" class="btn btn-primary w-100">
                  <i class="fas fa-filter me-1"></i> Aplicar
                </button>
              </div>
            </div>
          </div>

          <div class="col-md-9">
            <div class="card">
              <div class="card-header bg-white">
                <div class="d-flex justify-content-between align-items-center">
                  <h3 class="h5 mb-0">Pedidos Recentes</h3>
                  <div class="small text-muted" id="last-update">
                    Atualizado: agora
                  </div>
                </div>
              </div>
              <div class="card-body p-0">
                <div id="orders-list" class="list-group list-group-flush">
                  <!-- Pedidos serão adicionados dinamicamente aqui -->
                  <div class="list-group-item text-center py-5">
                    <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                    <p class="mb-0">Nenhum pedido encontrado</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal de Confirmação -->
  <div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Pedido Confirmado!</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center py-4">
          <i class="fas fa-check-circle text-success mb-3" style="font-size: 3rem;"></i>
          <h4 class="mb-3">Seu pedido foi recebido!</h4>
          <p class="mb-4">Agora vamos preparar seu pedido com todo cuidado. Você será redirecionado para o WhatsApp para confirmar os detalhes.</p>
          <div class="d-flex justify-content-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Carregando...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Login Admin -->
  <div class="modal fade" id="adminLoginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Acesso Administrativo</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="admin-login-form">
            <div class="mb-3">
              <label for="admin-username" class="form-label">Usuário</label>
              <input type="text" class="form-control" id="admin-username" required>
            </div>
            <div class="mb-3">
              <label for="admin-password" class="form-label">Senha</label>
              <input type="password" class="form-control" id="admin-password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">
              <i class="fas fa-sign-in-alt me-1"></i> Entrar
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Visualizar Pedido da Cozinha -->
  <div class="modal fade" id="kitchenOrderModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Pedido para Cozinha</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="kitchen-order-content">
          <!-- Conteúdo do pedido será inserido aqui -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          <button type="button" class="btn btn-primary" id="print-kitchen-order">
            <i class="fas fa-print me-1"></i> Imprimir
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-dark text-white py-4">
    <div class="container">
      <div class="row">
        <div class="col-md-4 mb-4 mb-md-0">
          <h3 class="h5"><span class="text-primary">Cozinha</span> da Vivi</h3>
          <p class="small text-muted">Comida caseira feita com ingredientes frescos e muito amor.</p>
        </div>
        <div class="col-md-4 mb-4 mb-md-0">
          <h3 class="h5">Horário de Funcionamento</h3>
          <ul class="list-unstyled small text-muted">
            <li>Segunda a Sexta: 11h às 22h</li>
            <li>Sábado: 11h às 23h</li>
            <li>Domingo: 11h às 17h</li>
          </ul>
        </div>
        <div class="col-md-4">
          <h3 class="h5">Contato</h3>
          <ul class="list-unstyled small text-muted">
            <li><i class="fas fa-phone-alt me-2"></i> (31) 3333-4444</li>
            <li><i class="fas fa-map-marker-alt me-2"></i> Rua das Flores, 123 - Centro</li>
            <li><i class="fab fa-whatsapp me-2"></i> (31) 93373-7672</li>
            <li class="mt-2">
              <button id="admin-login-button" class="btn btn-sm btn-outline-light">
                <i class="fas fa-lock me-1"></i> Acesso Restaurante
              </button>
            </li>
          </ul>
        </div>
      </div>
      <hr class="my-4 bg-secondary">
      <div class="text-center small text-muted">
        <p class="mb-0">&copy; 2025 Cozinha da Vivi - Todos os direitos reservados</p>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  
  <script>
    // Configurações do Firebase (com suas credenciais)
  const firebaseConfig = {
  apiKey: "AIzaSyCV809Fi4JTLZclARfU4MtNSAVkJIrGcfk",
  authDomain: "cozinha-da-vivi-83d09.firebaseapp.com",
  projectId: "cozinha-da-vivi-83d09",
  storageBucket: "cozinha-da-vivi-83d09.firebasestorage.app",
  messagingSenderId: "740046409209",
  appId: "1:740046409209:web:f8cff12dc530e22fba4128",
  databaseURL: "https://cozinha-da-vivi-83d09-default-rtdb.europe-west1.firebasedatabase.app"  // Adicione esta linha
};


// Defina a variável `database` fora do bloco try-catch
let database;

try {
  // Inicializa o Firebase
  firebase.initializeApp(firebaseConfig);
  console.log("Firebase inicializado com sucesso");

  // Agora você pode inicializar o Realtime Database
  database = firebase.database();
  console.log("Conexão com Realtime Database estabelecida");
} catch (error) {
  console.error("Erro ao inicializar Firebase:", error);
  Utils.showNotification("Erro de conexão com o banco de dados", 'danger');
}

// Função para verificar a conexão com o Firebase Realtime Database
const checkFirebaseConnection = async () => {
  try {
    // Verifica a conexão
    const snapshot = await database.ref('.info/connected').once('value');
    const connected = snapshot.val();
    console.log("Conectado ao Firebase:", connected);
    return connected;
  } catch (error) {
    console.error("Verificação de conexão falhou:", error);
    return false;
  }
};

// Configurações do aplicativo
const APP_CONFIG = {
  whatsappNumber: "351933737672",
  deliveryFee: 5.00,
  restaurantName: "Cozinha da Vivi",
  restaurantAddress: "Rua das Flores, 123 - Centro",
  adminCredentials: {
    username: "admin",
    password: "cozinhadavivi123"
  }
};

// Estado do aplicativo
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let orders = [];
let isAdminLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
let lastOrderCount = 0;

// Elementos do DOM (mantenha os mesmos seletores)
const DOM = {
  productSection: document.getElementById("product-section"),
  checkoutSection: document.getElementById("checkout-section"),
  adminPanel: document.getElementById("admin-panel"),
  cartItems: document.getElementById("cart-items"),
  totalElement: document.getElementById("total"),
  subtotalElement: document.getElementById("subtotal"),
  checkoutButton: document.getElementById("checkout-button"),
  cartCount: document.getElementById("cart-count"),
  cartIndicator: document.getElementById("cart-indicator"),
  productContainer: document.getElementById("product-container"),
  filterButtons: document.querySelectorAll('.filter-btn'),
  confirmationModal: new bootstrap.Modal(document.getElementById('confirmationModal')),
  adminLoginModal: new bootstrap.Modal(document.getElementById('adminLoginModal')),
  kitchenOrderModal: new bootstrap.Modal(document.getElementById('kitchenOrderModal')),
  adminLoginButton: document.getElementById("admin-login-button"),
  adminLogoutButton: document.getElementById("admin-logout"),
  backToCartButton: document.getElementById("back-to-cart-button"),
  confirmOrderButton: document.getElementById("confirm-order-button"),
  checkoutItems: document.getElementById("checkout-items"),
  checkoutSubtotal: document.getElementById("checkout-subtotal"),
  checkoutDeliveryFee: document.getElementById("checkout-delivery-fee"),
  checkoutTotal: document.getElementById("checkout-total"),
  deliveryOptionCards: document.querySelectorAll('.delivery-option-card'),
  paymentMethodCards: document.querySelectorAll('.payment-method-card'),
  deliveryFields: document.querySelectorAll('.delivery-field'),
  customerInfoForm: document.getElementById("customer-info-form"),
  cashChangeField: document.getElementById("cash-change-field"),
  ordersList: document.getElementById("orders-list"),
  todayOrders: document.getElementById("today-orders"),
  preparingOrders: document.getElementById("preparing-orders"),
  deliveryOrders: document.getElementById("delivery-orders"),
  statusFilter: document.getElementById("status-filter"),
  typeFilter: document.getElementById("type-filter"),
  applyFilters: document.getElementById("apply-filters"),
  kitchenOrderContent: document.getElementById("kitchen-order-content"),
  printKitchenOrder: document.getElementById("print-kitchen-order"),
  cartSidebar: document.getElementById("cart-sidebar"),
  cartOverlay: document.getElementById("cart-overlay"),
  closeCart: document.getElementById("close-cart"),
  lastUpdate: document.getElementById("last-update")
};

// Funções do Firebase
const FirebaseService = {
  saveOrder: async (order) => {
    try {
      const newOrderRef = database.ref('orders').push();
      await newOrderRef.set(order);
      return { ...order, id: newOrderRef.key };
    } catch (error) {
      console.error("Erro ao salvar pedido:", error);
      return null;
    }
  },

  listenForOrders: (callback) => {
    database.ref('orders').on('value', (snapshot) => {
      const ordersData = snapshot.val();
      const ordersArray = ordersData ? Object.keys(ordersData).map(key => ({
        id: key,
        ...ordersData[key]
      })) : [];
      callback(ordersArray);
    });
  },

  updateOrderStatus: async (orderId, newStatus) => {
    try {
      await database.ref(`orders/${orderId}/status`).set(newStatus);
      return true;
    } catch (error) {
      console.error("Erro ao atualizar status:", error);
      return false;
    }
  }
};

    // Funções utilitárias (mantenha as mesmas)
    const Utils = {
      formatCurrency: (value) => {
        return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
      },
      parsePrice: (priceString) => {
        return parseFloat(priceString.replace("R$", "").replace(",", ".").trim());
      },
      animateElement: (element, animation) => {
        element.classList.add("animate__animated", `animate__${animation}`);
        setTimeout(() => {
          element.classList.remove("animate__animated", `animate__${animation}`);
        }, 1000);
      },
      showNotification: (message, type = 'success') => {
        const notification = document.createElement('div');
        notification.className = `position-fixed bottom-0 end-0 m-3 alert alert-${type} alert-dismissible fade show`;
        notification.style.zIndex = '1100';
        notification.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 150);
        }, 3000);
      },
      validatePhone: (phone) => {
        return /^\+?[\d\s-]{10,15}$/.test(phone);
      },
      getTodayDate: () => {
        const today = new Date();
        return `${today.getDate()}/${today.getMonth() + 1}/${today.getFullYear()}`;
      },
      playNotificationSound: () => {
        const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
        audio.play().catch(e => console.log('Erro ao reproduzir som:', e));
      },
      updateTimestamp: () => {
        const now = new Date();
        DOM.lastUpdate.textContent = `Atualizado: ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
      }
    };

    // Funções do Carrinho (mantenha as mesmas)
    const Cart = {
      updateStorage: () => {
        localStorage.setItem('cart', JSON.stringify(cart));
      },

      addItem: (id, name, price, image = '') => {
        const existingItem = cart.find(item => item.id === id);
        
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({ id, name, price, quantity: 1, image });
        }
        
        Cart.updateStorage();
        Cart.updateUI();
        
        const productElement = document.querySelector(`.product[data-id="${id}"]`);
        if (productElement) {
          Utils.animateElement(productElement, 'pulse');
        }
        
        Utils.showNotification(`${name} adicionado ao carrinho!`);
      },

      updateItemQuantity: (id, newQuantity) => {
        const item = cart.find(item => item.id === id);
        if (item) {
          if (newQuantity <= 0) {
            Cart.removeItem(id);
          } else {
            item.quantity = newQuantity;
            Cart.updateStorage();
            Cart.updateUI();
          }
        }
      },

      removeItem: (id) => {
        const item = cart.find(item => item.id === id);
        if (item) {
          cart = cart.filter(item => item.id !== id);
          Cart.updateStorage();
          Cart.updateUI();
          Utils.showNotification(`${item.name} removido do carrinho`, 'warning');
        }
      },

      clear: () => {
        cart = [];
        Cart.updateStorage();
        Cart.updateUI();
      },

      getTotals: () => {
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const isDelivery = document.getElementById('delivery-method')?.checked || false;
        const deliveryFee = isDelivery ? APP_CONFIG.deliveryFee : 0;
        const total = subtotal + deliveryFee;
        
        return { subtotal, deliveryFee, total };
      },

      updateUI: () => {
        DOM.cartItems.innerHTML = "";
        
        const { subtotal, deliveryFee, total } = Cart.getTotals();
        const itemCount = cart.reduce((count, item) => count + item.quantity, 0);

        if (cart.length === 0) {
          DOM.cartItems.innerHTML = `
            <div class="list-group-item text-center py-4 empty-cart">
              <i class="fas fa-shopping-bag empty-cart-icon mb-3"></i>
              <p class="mb-0">Seu carrinho está vazio</p>
              <small class="text-muted">Adicione itens para continuar</small>
            </div>
          `;
        } else {
          cart.forEach(item => {
            const li = document.createElement("div");
            li.className = "list-group-item";
            li.innerHTML = `
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">${item.name}</h6>
                  <small class="text-muted">${Utils.formatCurrency(item.price)}</small>
                </div>
                <div class="d-flex align-items-center gap-3">
                  <div class="cart-item-quantity">
                    <button class="quantity-btn decrease" data-id="${item.id}">
                      <i class="fas fa-minus"></i>
                    </button>
                    <span class="quantity">${item.quantity}</span>
                    <button class="quantity-btn increase" data-id="${item.id}">
                      <i class="fas fa-plus"></i>
                    </button>
                  </div>
                  <span class="fw-bold">${Utils.formatCurrency(item.price * item.quantity)}</span>
                  <button class="remove-item btn btn-sm btn-outline-danger" data-id="${item.id}">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            `;
            DOM.cartItems.appendChild(li);
          });
        }

        DOM.subtotalElement.textContent = Utils.formatCurrency(subtotal);
        DOM.totalElement.textContent = Utils.formatCurrency(total);
        
        DOM.cartCount.textContent = itemCount;
        DOM.cartCount.style.display = itemCount > 0 ? "flex" : "none";
        
        DOM.checkoutButton.disabled = cart.length === 0;
      },
      
      toggleSidebar: () => {
        if (cart.length === 0) {
          DOM.cartSidebar.classList.remove('show');
          DOM.cartOverlay.classList.remove('show');
          return;
        }
        
        if (DOM.cartSidebar.classList.contains('show')) {
          DOM.cartSidebar.classList.remove('show');
          DOM.cartOverlay.classList.remove('show');
        } else {
          DOM.cartSidebar.classList.add('show');
          DOM.cartOverlay.classList.add('show');
        }
      }
    };

    // Funções de Pedido (adaptadas para Firebase)
    const Order = {
  create: () => {
    const { subtotal, deliveryFee, total } = Cart.getTotals();
    const deliveryType = document.querySelector('input[name="delivery-method"]:checked').value;
    const paymentMethod = document.querySelector('input[name="payment-method"]:checked')?.value || 'mbway';
    
    const customerInfo = {
      name: document.getElementById("customer-name").value,
      phone: document.getElementById("customer-phone").value,
      whatsapp: document.getElementById("customer-whatsapp").value || document.getElementById("customer-phone").value,
      address: document.getElementById("customer-address").value,
      complement: document.getElementById("customer-complement").value,
      neighborhood: document.getElementById("customer-neighborhood").value,
      instructions: document.getElementById("customer-instructions").value,
      notes: document.getElementById("order-notes").value
    };
    
    return {
      cliente: customerInfo.name,
      telefone: customerInfo.phone,
      whatsapp: customerInfo.whatsapp,
      itens: cart.map(item => ({
        nome: item.name,
        quantidade: item.quantity,
        preco: item.price
      })),
      subtotal,
      taxaEntrega: deliveryFee,
      total,
      status: 'pending',
      tipoEntrega: deliveryType,
      metodoPagamento: paymentMethod,
      trocoPara: paymentMethod === 'dinheiro' ? document.getElementById("cash-change").value || '0' : null,
      endereco: deliveryType === 'entrega' ? 
        `${customerInfo.address}, ${customerInfo.complement ? customerInfo.complement + ', ' : ''}${customerInfo.neighborhood}` : 
        'Retirada no local',
      instrucoes: customerInfo.instructions,
      observacoes: customerInfo.notes,
      data: new Date().toLocaleString('pt-BR'),
      restaurante: APP_CONFIG.restaurantName,
      enderecoRestaurante: APP_CONFIG.restaurantAddress
    };
  },

  saveOrder: async (order) => {
    try {
      console.log("Salvando pedido no Firebase...");
      const newOrderRef = database.ref('orders').push();
      await newOrderRef.set(order);
      console.log("Pedido salvo com ID:", newOrderRef.key);
      return { ...order, id: newOrderRef.key };
    } catch (error) {
      console.error("Erro ao salvar pedido:", error);
      throw error; // Rejeita a promise para ser capturada no sendToBackend
    }
  },

  sendToBackend: async () => {
    try {
      // Validação básica do carrinho
      if (cart.length === 0) {
        throw new Error("Carrinho vazio");
      }

      // Mostra estado de carregamento
      DOM.confirmOrderButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Processando...';
      DOM.confirmOrderButton.disabled = true;

      // Cria e salva o pedido
      const order = Order.create();
      const savedOrder = await Order.saveOrder(order);
      
      if (!savedOrder) {
        throw new Error("Falha ao salvar pedido");
      }

      return savedOrder;
      
    } catch (error) {
      console.error("Erro em sendToBackend:", error);
      Utils.showNotification(`Erro: ${error.message}`, 'danger');
      return null;
      
    } finally {
      // Restaura o botão independentemente do resultado
      DOM.confirmOrderButton.innerHTML = '<i class="fas fa-check-circle me-2"></i> Confirmar Pedido';
      DOM.confirmOrderButton.disabled = false;
    }
  },

      sendToWhatsApp: (pedido) => {
        const itemsText = pedido.itens.map(item => 
          `➡ ${item.nome} - ${item.quantidade}x ${Utils.formatCurrency(item.preco)} = ${Utils.formatCurrency(item.preco * item.quantidade)}`
        ).join("%0A");
        
        const deliveryText = pedido.tipoEntrega === 'entrega' ? 
          `%0A%0A📍 *Endereço de entrega:*%0A${pedido.endereco}%0A%0A📝 *Instruções:*%0A${pedido.instrucoes || 'Nenhuma instrução adicional'}` : 
          `%0A%0A🏪 *Retirada no local*%0A${APP_CONFIG.restaurantAddress}`;
        
        let paymentText = '';
        if (pedido.metodoPagamento === 'mbway') {
          paymentText = `💳 *Pagamento via MB Way*%0AVocê receberá uma solicitação de pagamento`;
        } else if (pedido.metodoPagamento === 'dinheiro') {
          paymentText = `💵 *Pagamento em dinheiro*%0ATroco para: R$ ${pedido.trocoPara || 'Sem troco'}`;
        } else {
          paymentText = `💳 *Pagamento com cartão*%0AMáquina será levada na entrega/retirada`;
        }
        
        const notesText = pedido.observacoes ? `%0A%0A📌 *Observações do pedido:*%0A${pedido.observacoes}` : '';
        
        const message = `*📝 Novo Pedido - ${APP_CONFIG.restaurantName}*%0A%0A👤 *Cliente:* ${pedido.cliente}%0A📞 *Telefone:* ${pedido.telefone}%0A✉ *WhatsApp:* ${pedido.whatsapp}%0A%0A📦 *Itens do Pedido:*%0A${itemsText}%0A%0A💰 *Valores:*%0A*Subtotal:* ${Utils.formatCurrency(pedido.subtotal)}%0A*Taxa de entrega:* ${Utils.formatCurrency(pedido.taxaEntrega)}%0A*Total:* ${Utils.formatCurrency(pedido.total)}%0A%0A🚚 *Forma de recebimento:* ${pedido.tipoEntrega === 'entrega' ? 'Entrega' : 'Retirada no local'}${deliveryText}%0A%0A${paymentText}${notesText}%0A%0A⏰ *Data/hora:* ${pedido.data}%0A%0A_🔔 Aguardando confirmação do restaurante_`;
        
        const whatsappURL = `https://wa.me/${APP_CONFIG.whatsappNumber}?text=${message}`;
        
        DOM.confirmationModal.show();
        
        setTimeout(() => {
          window.open(whatsappURL, "_blank");
          DOM.confirmationModal.hide();
          Cart.clear();
          DOM.productSection.classList.remove("d-none");
          DOM.checkoutSection.classList.add("d-none");
          Cart.toggleSidebar();
        }, 3000);
      },

      updateAdminPanel: () => {
        const statusFilter = DOM.statusFilter.value;
        const typeFilter = DOM.typeFilter.value;
        
        let filteredOrders = [...orders].reverse();
        
        if (statusFilter !== 'all') {
          filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
        }
        
        if (typeFilter !== 'all') {
          filteredOrders = filteredOrders.filter(order => order.tipoEntrega === typeFilter);
        }
        
        DOM.ordersList.innerHTML = '';
        
        if (filteredOrders.length === 0) {
          DOM.ordersList.innerHTML = `
            <div class="list-group-item text-center py-5">
              <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
              <p class="mb-0">Nenhum pedido encontrado</p>
            </div>
          `;
        } else {
          filteredOrders.forEach(order => {
            const orderElement = document.createElement('div');
            orderElement.className = 'list-group-item';
            orderElement.innerHTML = `
              <div class="order-card p-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div>
                    <h5 class="mb-1">Pedido #${order.id.slice(-6)}</h5>
                    <p class="mb-1 small text-muted"><i class="fas fa-user me-1"></i> ${order.cliente}</p>
                    <p class="mb-1 small text-muted"><i class="fas fa-phone me-1"></i> ${order.telefone}</p>
                  </div>
                  <div>
                    <span class="badge order-status-badge ${Order.getStatusClass(order.status)}">${Order.getStatusText(order.status)}</span>
                  </div>
                </div>
                
                <div class="mb-2">
                  <p class="mb-1 small"><i class="fas ${order.tipoEntrega === 'entrega' ? 'fa-motorcycle' : 'fa-store'} me-1"></i> ${order.tipoEntrega === 'entrega' ? 'Entrega' : 'Retirada'}</p>
                  <p class="mb-1 small text-muted"><i class="fas fa-money-bill-wave me-1"></i> ${Order.getPaymentText(order.metodoPagamento, order.trocoPara)}</p>
                  ${order.observacoes ? `<p class="mb-1 small text-muted"><i class="fas fa-sticky-note me-1"></i> ${order.observacoes}</p>` : ''}
                </div>
                
                <div class="border-top pt-2 mb-2">
                  ${order.itens.map(item => `
                    <div class="d-flex justify-content-between small">
                      <span>${item.quantidade}x ${item.nome}</span>
                      <span>${Utils.formatCurrency(item.preco * item.quantidade)}</span>
                    </div>
                  `).join('')}
                </div>
                
                <div class="d-flex justify-content-between border-top pt-2">
                  <div>
                    <span class="small text-muted">${order.data}</span>
                  </div>
                  <div class="text-end">
                    <div class="small text-muted">Total: ${Utils.formatCurrency(order.total)}</div>
                    <div class="order-actions mt-1">
                      <button class="btn btn-outline-primary btn-sm update-status" data-id="${order.id}" data-status="preparing">
                        <i class="fas fa-utensils me-1"></i> Preparar
                      </button>
                      <button class="btn btn-outline-success btn-sm update-status" data-id="${order.id}" data-status="ready">
                        <i class="fas fa-check me-1"></i> Pronto
                      </button>
                      <button class="btn btn-outline-danger btn-sm update-status" data-id="${order.id}" data-status="cancelled">
                        <i class="fas fa-times me-1"></i> Cancelar
                      </button>
                      <button class="btn btn-outline-secondary btn-sm view-kitchen-order" data-id="${order.id}">
                        <i class="fas fa-print me-1"></i> Imprimir
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            `;
            DOM.ordersList.appendChild(orderElement);
          });
        }
        
        const today = Utils.getTodayDate();
        const todayOrdersCount = orders.filter(order => order.data.includes(today)).length;
        const preparingOrdersCount = orders.filter(order => order.status === 'preparing').length;
        const deliveryOrdersCount = orders.filter(order => order.status === 'ready' && order.tipoEntrega === 'entrega').length;
        
        DOM.todayOrders.textContent = todayOrdersCount;
        DOM.preparingOrders.textContent = preparingOrdersCount;
        DOM.deliveryOrders.textContent = deliveryOrdersCount;
        
        Utils.updateTimestamp();
      },
      
      getStatusText: (status) => {
        switch(status) {
          case 'pending': return 'Pendente';
          case 'preparing': return 'Em Preparo';
          case 'ready': return 'Pronto';
          case 'delivered': return 'Entregue';
          case 'cancelled': return 'Cancelado';
          default: return status;
        }
      },
      
      getStatusClass: (status) => {
        switch(status) {
          case 'pending': return 'status-pending';
          case 'preparing': return 'status-preparing';
          case 'ready': return 'status-ready';
          case 'delivered': return 'status-delivered';
          case 'cancelled': return 'status-cancelled';
          default: return 'bg-secondary';
        }
      },
      
      getPaymentText: (method, change) => {
        switch(method) {
          case 'mbway': return 'MB Way';
          case 'dinheiro': return `Dinheiro${change ? ' (Troco p/ ' + Utils.formatCurrency(parseFloat(change)) + ')' : ''}`;
          case 'cartao': return 'Cartão';
          default: return method;
        }
      },
      
      updateStatus: (orderId, newStatus) => {
        FirebaseService.updateOrderStatus(orderId, newStatus).then(success => {
          if (success) {
            Utils.showNotification(`Status do pedido #${orderId.slice(-6)} atualizado para ${Order.getStatusText(newStatus)}`, 'success');
          }
        });
      },
      
      generateKitchenOrder: (orderId) => {
        const order = orders.find(o => o.id === orderId);
        if (!order) return '';
        
        const itemsText = order.itens.map(item => `
          <div class="kitchen-order-item">
            <span>${item.quantidade}x ${item.nome}</span>
          </div>
        `).join('');
        
        const notes = order.observacoes ? `
          <div class="kitchen-order-item">
            <span><strong>OBS:</strong> ${order.observacoes}</span>
          </div>
        ` : '';
        
        const kitchenOrder = `
          <div class="kitchen-order" id="kitchen-order-print">
            <div class="kitchen-order-header">
              ${APP_CONFIG.restaurantName}<br>
              Pedido #${order.id.slice(-6)}
            </div>
            
            <div class="kitchen-order-item">
              <span><strong>Cliente:</strong> ${order.cliente}</span>
            </div>
            
            <div class="kitchen-order-item">
              <span><strong>${order.tipoEntrega === 'entrega' ? 'Entrega' : 'Retirada'}</strong></span>
            </div>
            
            ${order.tipoEntrega === 'entrega' ? `
              <div class="kitchen-order-item">
                <span><strong>Endereço:</strong> ${order.endereco}</span>
              </div>
              
              ${order.instrucoes ? `
                <div class="kitchen-order-item">
                  <span><strong>Instruções:</strong> ${order.instrucoes}</span>
                </div>
              ` : ''}
            ` : ''}
            
            <div class="kitchen-order-item">
              <span><strong>Data:</strong> ${order.data}</span>
            </div>
            
            <div style="margin: 10px 0; border-top: 1px dashed #000;"></div>
            
            ${itemsText}
            
            ${notes}
            
            <div class="kitchen-order-footer">
              Total: ${Utils.formatCurrency(order.total)}
            </div>
          </div>
        `;
        
        return kitchenOrder;
      },
      
      printKitchenOrder: (orderId) => {
        const kitchenOrder = Order.generateKitchenOrder(orderId);
        DOM.kitchenOrderContent.innerHTML = kitchenOrder;
        
        // Abre janela de impressão
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>Pedido Cozinha</title>
            <style>
              body { font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.3; }
              .kitchen-order { max-width: 58mm; padding: 10px; }
              .kitchen-order-header { text-align: center; font-weight: bold; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 5px; }
              .kitchen-order-item { display: flex; justify-content: space-between; margin-bottom: 3px; }
              .kitchen-order-footer { border-top: 1px dashed #000; margin-top: 10px; padding-top: 5px; font-weight: bold; }
            </style>
          </head>
          <body onload="window.print();window.close()">
            ${kitchenOrder}
          </body>
          </html>
        `);
        printWindow.document.close();
      }
    };

    // Funções de Filtro (mantenha as mesmas)
    const Filter = {
      apply: (category) => {
        const products = document.querySelectorAll('.product');
        
        products.forEach(product => {
          if (category === 'all' || product.dataset.category === category) {
            product.style.display = 'block';
          } else {
            product.style.display = 'none';
          }
        });
        
        DOM.filterButtons.forEach(button => {
          if (button.dataset.category === category) {
            button.classList.add('active');
          } else {
            button.classList.remove('active');
          }
        });
      }
    };

    // Funções de Checkout (mantenha as mesmas)
    const Checkout = {
      init: () => {
        const { subtotal, deliveryFee, total } = Cart.getTotals();
        
        DOM.checkoutSubtotal.textContent = Utils.formatCurrency(subtotal);
        DOM.checkoutDeliveryFee.textContent = Utils.formatCurrency(deliveryFee);
        DOM.checkoutTotal.textContent = Utils.formatCurrency(total);
        
        DOM.checkoutItems.innerHTML = '';
        cart.forEach(item => {
          const li = document.createElement("div");
          li.className = "list-group-item";
          li.innerHTML = `
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="mb-1">${item.name}</h6>
                <small class="text-muted">${Utils.formatCurrency(item.price)}</small>
              </div>
              <div class="d-flex align-items-center gap-3">
                <span class="quantity">${item.quantity}x</span>
                <span class="fw-bold">${Utils.formatCurrency(item.price * item.quantity)}</span>
              </div>
            </div>
          `;
          DOM.checkoutItems.appendChild(li);
        });
      },
      
      toggleDeliveryFields: (show) => {
        DOM.deliveryFields.forEach(field => {
          field.style.display = show ? 'block' : 'none';
        });
        
        const deliveryFee = show ? APP_CONFIG.deliveryFee : 0;
        DOM.checkoutDeliveryFee.textContent = Utils.formatCurrency(deliveryFee);
        
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const total = subtotal + deliveryFee;
        DOM.checkoutTotal.textContent = Utils.formatCurrency(total);
      }
    };

    // Funções de Admin (adaptadas para Firebase)
    const Admin = {
      login: (username, password) => {
        if (username === APP_CONFIG.adminCredentials.username && password === APP_CONFIG.adminCredentials.password) {
          isAdminLoggedIn = true;
          localStorage.setItem('adminLoggedIn', 'true');
          
          DOM.productSection.classList.add("d-none");
          DOM.checkoutSection.classList.add("d-none");
          DOM.adminPanel.classList.remove("d-none");
          
          Order.updateAdminPanel();
          
          DOM.adminLoginModal.hide();
          
          return true;
        }
        return false;
      },
      
      logout: () => {
        isAdminLoggedIn = false;
        localStorage.setItem('adminLoggedIn', 'false');
        
        DOM.productSection.classList.remove("d-none");
        DOM.checkoutSection.classList.add("d-none");
        DOM.adminPanel.classList.add("d-none");
      },
      
      checkLoginStatus: () => {
        if (isAdminLoggedIn) {
          DOM.productSection.classList.add("d-none");
          DOM.checkoutSection.classList.add("d-none");
          DOM.adminPanel.classList.remove("d-none");
          Order.updateAdminPanel();
        }
      }
    };

    // Event Listeners
    function setupEventListeners() {
      document.addEventListener('click', (event) => {
        if (event.target.closest('.add-to-cart')) {
          const button = event.target.closest('.add-to-cart');
          const productElement = button.closest('.product');
          const id = productElement.getAttribute("data-id");
          const name = productElement.querySelector(".product-name").textContent;
          const price = Utils.parsePrice(productElement.querySelector(".product-price").textContent);
          const image = productElement.querySelector(".product-image")?.src || '';
          
          Cart.addItem(id, name, price, image);
        }
      });

      DOM.cartItems.addEventListener("click", (event) => {
        if (event.target.closest(".remove-item")) {
          const id = event.target.closest(".remove-item").getAttribute("data-id");
          Cart.removeItem(id);
        }
        
        if (event.target.closest(".increase")) {
          const id = event.target.closest(".increase").getAttribute("data-id");
          const item = cart.find(item => item.id === id);
          if (item) {
            Cart.updateItemQuantity(id, item.quantity + 1);
          }
        }
        
        if (event.target.closest(".decrease")) {
          const id = event.target.closest(".decrease").getAttribute("data-id");
          const item = cart.find(item => item.id === id);
          if (item) {
            Cart.updateItemQuantity(id, item.quantity - 1);
          }
        }
      });

      DOM.checkoutButton.addEventListener("click", () => {
        DOM.productSection.classList.add("d-none");
        DOM.checkoutSection.classList.remove("d-none");
        Checkout.init();
        Cart.toggleSidebar();
      });

      DOM.backToCartButton.addEventListener("click", () => {
        DOM.productSection.classList.remove("d-none");
        DOM.checkoutSection.classList.add("d-none");
      });

      DOM.confirmOrderButton.addEventListener("click", async () => {
  // Verifique campos obrigatórios
  const name = document.getElementById("customer-name").value;
  const phone = document.getElementById("customer-phone").value;
  const isDelivery = document.getElementById("delivery-method").checked;
  const address = document.getElementById("customer-address").value;
  const neighborhood = document.getElementById("customer-neighborhood").value;
  
  if (!name || !phone) {
    Utils.showNotification("Por favor, preencha seu nome e telefone", 'danger');
    return;
  }
  
  if (!Utils.validatePhone(phone)) {
    Utils.showNotification("Por favor, insira um telefone válido", 'danger');
    return;
  }
  
  if (isDelivery && (!address || !neighborhood)) {
    Utils.showNotification("Por favor, preencha seu endereço completo", 'danger');
    return;
  }

  // Verifique conexão com Firebase
  const isConnected = await checkFirebaseConnection();
  if (!isConnected) {
    Utils.showNotification("Sem conexão com o banco de dados. Tente novamente.", 'danger');
    return;
  }

  // Processe o pedido
  const pedido = await Order.sendToBackend();
  if (pedido) {
    Order.sendToWhatsApp(pedido);
  } else {
    Utils.showNotification("Falha ao processar pedido. Verifique sua conexão.", 'danger');
  }
});
      DOM.filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          Filter.apply(button.dataset.category);
        });
      });

      DOM.cartIndicator.addEventListener('click', () => {
        Cart.toggleSidebar();
      });
      
      DOM.closeCart.addEventListener('click', () => {
        Cart.toggleSidebar();
      });
      
      DOM.cartOverlay.addEventListener('click', () => {
        Cart.toggleSidebar();
      });
      
      DOM.deliveryOptionCards.forEach(card => {
        card.addEventListener('click', () => {
          const input = card.querySelector('input');
          input.checked = true;
          
          DOM.deliveryOptionCards.forEach(c => c.classList.remove('active'));
          card.classList.add('active');
          
          Checkout.toggleDeliveryFields(input.value === 'entrega');
        });
      });
      
      DOM.paymentMethodCards.forEach(card => {
        card.addEventListener('click', () => {
          const input = card.querySelector('input');
          input.checked = true;
          
          DOM.paymentMethodCards.forEach(c => c.classList.remove('active'));
          card.classList.add('active');
          
          if (input.value === 'dinheiro') {
            DOM.cashChangeField.classList.remove('d-none');
          } else {
            DOM.cashChangeField.classList.add('d-none');
          }
        });
      });
      
      DOM.adminLoginButton.addEventListener('click', () => {
        DOM.adminLoginModal.show();
      });
      
      document.getElementById('admin-login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('admin-username').value;
        const password = document.getElementById('admin-password').value;
        
        if (Admin.login(username, password)) {
          Utils.showNotification('Login realizado com sucesso!', 'success');
        } else {
          Utils.showNotification('Credenciais inválidas', 'danger');
        }
      });
      
      DOM.adminLogoutButton.addEventListener('click', () => {
        Admin.logout();
        Utils.showNotification('Logout realizado com sucesso', 'info');
      });
      
      DOM.ordersList.addEventListener('click', (event) => {
        if (event.target.closest('.update-status')) {
          const button = event.target.closest('.update-status');
          const orderId = button.getAttribute('data-id');
          const newStatus = button.getAttribute('data-status');
          
          Order.updateStatus(orderId, newStatus);
        }
        
        if (event.target.closest('.view-kitchen-order')) {
          const button = event.target.closest('.view-kitchen-order');
          const orderId = button.getAttribute('data-id');
          const kitchenOrder = Order.generateKitchenOrder(orderId);
          
          DOM.kitchenOrderContent.innerHTML = kitchenOrder;
          DOM.kitchenOrderModal.show();
        }
      });
      
      DOM.printKitchenOrder.addEventListener('click', () => {
        const orderId = document.querySelector('.view-kitchen-order.active')?.getAttribute('data-id') || 
                        document.querySelector('.view-kitchen-order')?.getAttribute('data-id');
        if (orderId) {
          Order.printKitchenOrder(orderId);
          DOM.kitchenOrderModal.hide();
        }
      });
      
      DOM.applyFilters.addEventListener('click', () => {
        Order.updateAdminPanel();
      });
    }

    // Inicialização
    function init() {
      setupEventListeners();
      Cart.updateUI();
      Filter.apply('all');
      Checkout.toggleDeliveryFields(true);
      
      // Inicializa o listener de pedidos do Firebase
      FirebaseService.listenForOrders((ordersFromFirebase) => {
        orders = ordersFromFirebase;
        
        // Verifica se há novos pedidos pendentes
        const newPendingOrders = orders.filter(o => o.status === 'pending').length;
        if (newPendingOrders > lastOrderCount && isAdminLoggedIn) {
          Utils.playNotificationSound();
          Utils.showNotification('Novo pedido recebido!', 'success');
        }
        lastOrderCount = newPendingOrders;
        
        if (isAdminLoggedIn) {
          Order.updateAdminPanel();
        }
      });
      
      Admin.checkLoginStatus();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>